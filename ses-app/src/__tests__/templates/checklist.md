# 統合テスト実装チェックリスト

新しいサーバーコンポーネントページの統合テストを実装する際のチェックリストです。

## 📋 事前準備

### [ ] 1. テンプレートコピー
```bash
cp src/__tests__/templates/server-component-integration.template.tsx \
   src/__tests__/integration/your-feature-pages.test.tsx
```

### [ ] 2. 対象ページの確認
- [ ] サーバーコンポーネントである（`"use client"`がない）
- [ ] Prismaを使用したデータ取得がある
- [ ] 401エラーの可能性がある（API経由のデータ取得）

## 🔧 実装作業

### [ ] 3. 基本設定の置換

#### [ ] インポート文
- [ ] ページコンポーネントのインポート
- [ ] generateMetadata関数のインポート（ある場合）
- [ ] 型定義のインポート

#### [ ] モック設定
- [ ] Prismaテーブル名の変更（`tableName` → 実際のテーブル名）
- [ ] 複数テーブルの場合は追加
- [ ] Next.js navigationモックの確認

### [ ] 4. データ構造の定義

#### [ ] 型定義
- [ ] インターフェース名の変更
- [ ] 実際のフィールドに合わせた定義
- [ ] Date型フィールドの確認

#### [ ] モックデータ
- [ ] 実際のデータ構造に合わせたモックデータ作成
- [ ] リレーションデータの追加（必要な場合）
- [ ] Date型の適切な設定

### [ ] 5. テストケースの実装

#### [ ] fetchData関数テスト
- [ ] 正常なデータ取得テスト
  - [ ] Prismaクエリの期待値確認
  - [ ] includeブロックの設定
- [ ] データ未発見時のテスト
  - [ ] notFound()の呼び出し確認
- [ ] データベースエラーテスト
  - [ ] エラーハンドリングの確認

#### [ ] generateMetadataテスト（該当する場合）
- [ ] 正常なメタデータ生成テスト
- [ ] エラー時のデフォルトメタデータテスト
- [ ] title/descriptionの内容確認

#### [ ] レンダリングテスト
- [ ] 正常データでの表示テスト
- [ ] エラー時のnotFound呼び出しテスト
- [ ] 表示内容の確認

#### [ ] 401エラー回避実証テスト
- [ ] 旧API方式の401エラー確認
- [ ] 新Prisma方式の正常動作確認

## 🎯 データ構造別の設定

### [ ] 6. エンジニア系の場合
- [ ] userテーブルの使用
- [ ] skillsリレーションの設定
- [ ] availableFromのDate変換

### [ ] 7. プロジェクト系の場合
- [ ] projectテーブルの使用
- [ ] periodStart/periodEndのDate変換
- [ ] publishedAt/lastContactedAtのnullable処理

### [ ] 8. インタラクション系の場合
- [ ] interactionテーブルの使用
- [ ] 複数テーブル（user, project）の設定
- [ ] readAtのnullable処理

## ✅ 動作確認

### [ ] 9. テスト実行
```bash
# 個別テスト実行
npm test your-feature-pages.test.tsx

# 全テスト実行
npm test

# カバレッジ確認
npm run test:coverage
```

### [ ] 10. 結果確認
- [ ] 全テストがパスしている
- [ ] コンソールエラーがない（想定内のログは除く）
- [ ] モックが適切に呼ばれている
- [ ] 401エラー回避が確認できている

## 🔍 コードレビュー

### [ ] 11. コード品質チェック
- [ ] TODOコメントがすべて置換されている
- [ ] 不要なコメントアウトがない
- [ ] テスト名が適切である
- [ ] アサーション（expect）が適切である

### [ ] 12. 実装の整合性
- [ ] 実際のページコンポーネントと一致している
- [ ] Prismaスキーマと一致している
- [ ] 型定義と一致している
- [ ] Date型変換処理が正確である

## 📚 ドキュメント更新

### [ ] 13. ドキュメント追記
- [ ] 新しいテストファイルの存在を記録
- [ ] 特殊な実装があれば注記
- [ ] 今後の参考情報があれば追記

## 🚨 よくある間違い

### チェックポイント
- [ ] Prismaテーブル名の不一致
- [ ] Date型変換の漏れ
- [ ] includeブロックの設定ミス
- [ ] generateMetadataの有無確認漏れ
- [ ] モックデータの型不一致
- [ ] テスト名の重複
- [ ] 非同期処理のawait漏れ

## 🎉 完了確認

### [ ] 14. 最終チェック
- [ ] 全271テスト（既存）+ 新規テストがパス
- [ ] 401エラーが解決されている
- [ ] 新機能が適切にテストされている
- [ ] コードカバレッジが維持されている
- [ ] チームメンバーのレビューを受けた

---

## 🔗 参考資料

- [既存テスト例](../integration/engineer-pages.test.tsx)
- [プロジェクトテスト例](../integration/project-pages.test.tsx)
- [インタラクションテスト例](../integration/interaction-pages.test.tsx)
- [テンプレート使用方法](./README.md)

このチェックリストを活用して、品質の高い統合テストを効率的に実装してください。 